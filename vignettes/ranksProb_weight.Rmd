---
title: "Ranks probability and weights"
author: "Mohamad Shakil Hasan"
date: "`r doc_date()`"
package: "`r pkg_ver('OPWpaper')`"
output: BiocStyle::html_document
#bibliography: bibliography.bib
vignette: >
  %\VignetteIndexEntry{"Ranks probability and weights"}
  %\VignetteEngine{knitr::rmarkdown}
  %\usepackage[utf8]{inputenc}
---

```{r setup, echo = FALSE}
knitr::opts_chunk$set(fig.width = 8, fig.height = 8)
knitr::opts_chunk$set(tidy = FALSE, cache = TRUE, autodep = TRUE)
```

Below we generate the necessary plots to demonstrate the ranks probability and the corresponding normalized weight for the different effect sizes and the proportion of the true nulls.

Load necessary libraries

```{r loadLib, message=FALSE, warning=FALSE}
library(OPWeight)       # library for the proposed method
library(OPWpaper)       
library(ggplot2)
library(reshape2)       # library for the melt function
library(cowplot)        # plot_grid function
```

# Ranks probability and weights
Load data stored in `r Biocpkg("OPWpaper")` 

```{r load_ranks_weight_data}
ranksProb_dat <- system.file("simulations/results/ranksProb_byEffect_m10000.csv", 
                         package = "OPWpaper")
weight_dat <- system.file("simulations/results/Weight_byEffect_cont_m10000.csv", 
                         package = "OPWpaper")
m = 10000
ranksProb <- read.csv(ranksProb_dat, h = TRUE)
ranksWeight <- read.csv(weight_dat, h = TRUE)
```
The following Figures the ranks probabilities, $P(r_i=k \mid E(\varepsilon_i))$, and the corresponding normalized weights, $w_i$, versus ranks, where the mean filter effect size $E(\varepsilon_i)$ refers to $ey$. For each figure, the first column is for the different proportion of the true null hypothesis when the mean test-effect ($et$) and the mean filter-effect ($ey$) are the same, and the second column is for the different mean effect sizes when the proportion of the true null tests is $90\%$. To generate this plot, we applied the proposed normal approximation method. We assumed that there are $m = 10,000$ hypotheses tests; the test statistics follow normal distributions with mean $0$ and $\varepsilon_i$ under the null and alternative hypothesis, respectively, and standard deviations $1$.  

```{r plots}
prob_weight_plots(ey_index = c(7, 17, 27, 37), null_index = c(14, 17, 19),
                                m = 10000, ey = 2, null = 50, prob = ranksProb,
                                weight = ranksWeight)

prob_weight_plots(ey_index = c(7, 17, 27, 37), null_index = c(34, 37, 39),
                                m = 10000, ey = 2, null = 90, prob = ranksProb,
                                weight = ranksWeight)

prob_weight_plots(ey_index = c(6, 16, 26, 36), null_index = c(14, 17, 19),
                                m = 10000, ey = 1, null = 50, prob = ranksProb,
                                weight = ranksWeight)

prob_weight_plots(ey_index = c(6, 16, 26, 36), null_index = c(34, 37, 39),
                                m = 10000, ey = 1, null = 90, prob = ranksProb,
                                weight = ranksWeight)
```

# References
I will include later
